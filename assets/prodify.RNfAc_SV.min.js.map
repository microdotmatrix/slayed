{"version":3,"file":"prodify.RNfAc_SV.min.js","sources":["../frontend/js/prodify.js"],"sourcesContent":["class Prodify {\n  constructor(settings) {\n    this.settings = {\n      ...settings\n    }\n\n    this.el = document.querySelector('[data-prodify]')\n    this.pickerType = this.el.dataset.prodify\n\n    this.selectors = {\n      priceContainer: '[data-prodify-price-container]',\n      mediaContainer: '[data-prodify-media-container]',\n      variantsJson: '[data-prodify-variants-json]',\n      optionContainer: '[data-prodify-option-container]',\n      productForm: '[data-prodify-product-form]',\n      quantityIncrement: '[data-prodify-quantity-increment]',\n      quantityDecrement: '[data-prodify-quantity-decrement]',\n      quantityPresentation: '[data-prodify-quantity-presentation]',\n    }\n\n    this.textStrings = {\n      addToCart: window.variantStrings.addToCart,\n      unavailableVariantValueLabel: window.variantStrings.unavailable_with_option,\n      soldOutVariantValueLabel: window.variantStrings.soldout_with_option,\n      addButtonTextUnavailable: window.variantStrings.unavailable,\n    }\n\n    this.quantityIncrementButton = this.el.querySelector(this.selectors.quantityIncrement)\n    this.quantityDecrementButton = this.el.querySelector(this.selectors.quantityDecrement)\n    this.quantityPresentationInput = this.el.querySelector(this.selectors.quantityPresentation)\n    this.quantityHiddenInput = this.el.querySelector('input[name=\"quantity\"]')\n\n    this.initEventListeners()\n  }\n\n  initEventListeners = () => {\n    this.el.addEventListener('change', this.onVariantChange)\n\n    if (\n      this.quantityIncrementButton &&\n      this.quantityDecrementButton &&\n      this.quantityPresentationInput\n    ) {\n      this.quantityIncrementButton.addEventListener('click', () => {\n        this.updateQuantity('up')\n      })\n\n      this.quantityDecrementButton.addEventListener('click', () => {\n        this.updateQuantity('down')\n      })\n    }\n  }\n\n  updateCurrentVariant = () => {\n    const variants = this.getVariantData();\n    const matchingVariant = variants.find(variant => {\n      return variant.options.every((option, index) => {\n        return this.options[index] === option;\n      });\n    });\n    this.currentVariant = matchingVariant;\n  };\n\n  updateQuantity = (stepDirection) => {\n    const previousQuantity = parseInt(this.quantityPresentationInput.value)\n\n    if (stepDirection == 'up') {\n      this.quantityHiddenInput.value = this.quantityPresentationInput.value = previousQuantity + 1\n    } else {\n      this.quantityHiddenInput.value = this.quantityPresentationInput.value = Math.max(1, previousQuantity - 1)\n    }\n  }\n\n  updateCurrentOptions = () => {\n    if (this.pickerType == 'select') {\n      this.options = Array.from(this.el.querySelectorAll('select'), (select) => select.value)\n      return\n    }\n\n    this.optionContainers = Array.from(this.el.querySelectorAll(this.selectors.optionContainer))\n    this.options = this.optionContainers.map((optionContainer) => {\n      return Array.from(optionContainer.querySelectorAll('input')).find((radio) => radio.checked)\n        .value\n    })\n  }\n\n  updateVariantIdInput() {\n    const productForms = document.querySelectorAll(this.selectors.productForm)\n    productForms.forEach((productForm) => {\n      const input = productForm.querySelector('input[name=\"id\"]')\n      input.value = this.currentVariant.id\n      // input.dispatchEvent(new Event('change', { bubbles: true }));\n    })\n  }\n\n  updateURL() {\n    if (!this.currentVariant || this.el.dataset.updateUrl === 'false') return\n    window.history.replaceState({}, '', `${this.el.dataset.url}?variant=${this.currentVariant.id}`)\n  }\n\n  updateAddButtonDom(disable = true, text, modifyClass = true) {\n    const productForm = document.querySelector(this.selectors.productForm)\n    if (!productForm) return\n    const addButton = productForm.querySelector('[name=\"add\"]')\n    const addButtonText = productForm.querySelector('[name=\"add\"] > span')\n    if (!addButton) return\n\n    if (disable) {\n      addButton.setAttribute('disabled', 'disabled')\n      if (text) addButtonText.textContent = text\n    } else {\n      addButton.removeAttribute('disabled')\n      addButtonText.textContent = this.textStrings.addButtonTextUnavailable\n    }\n\n    if (!modifyClass) return\n\n    if (disable) {\n      addButton.classList.add('disabled')\n    } else {\n      addButton.classList.remove('disabled')\n    }\n  }\n\n  onVariantChange = (event) => {\n\n    this.updateCurrentOptions()\n    this.updateCurrentVariant()\n    this.updateAddButtonDom(true, '', false)\n    this.compareInputValues()\n    this.setOptionSelected(event.target)\n    \n    if (!this.currentVariant) {\n      this.updateAddButtonDom(true, this.textStrings.addButtonTextUnavailable, true)\n    } else {\n      this.updateURL()\n      this.updateVariantIdInput()\n      this.swapProductInfo()\n    }\n  }\n\n  setOptionSelected(select) {\n    if (this.pickerType == 'select') {\n      const options = Array.from(select.querySelectorAll('option'))\n      const currentValue = select.value\n\n      options.forEach((option) => {\n        if (option.value === currentValue) {\n          option.setAttribute('selected', 'selected')\n        } else {\n          option.removeAttribute('selected')\n        }\n      })\n    }\n  }\n\n  compareInputValues() {\n    const variantsMatchingOptionOneSelected = this.variantData.filter(\n      // Grab the first checked input and compare it to the variant option1\n      // return an array of variants where the option1 matches the checked input\n      (variant) => this.el.querySelector(':checked').value === variant.option1\n    )\n\n    const inputWrappers = [...this.el.querySelectorAll(this.selectors.optionContainer)]\n    inputWrappers.forEach((option, index) => {\n      if (index === 0) return\n      const optionInputs = [...option.querySelectorAll('input[type=\"radio\"], option')]\n      const previousOptionSelected = inputWrappers[index - 1].querySelector(':checked').value\n      const availableOptionInputsValues = variantsMatchingOptionOneSelected\n        .filter(\n          // \n          (variant) => variant.available && variant[`option${index}`] === previousOptionSelected\n        )\n        .map((variantOption) => variantOption[`option${index + 1}`])\n\n      const existingOptionInputsValues = variantsMatchingOptionOneSelected\n        .filter(\n          // \n          (variant) => variant[`option${index}`] === previousOptionSelected\n        )\n        .map((variantOption) => variantOption[`option${index + 1}`])\n\n      this.setInputAvailability(optionInputs, availableOptionInputsValues, existingOptionInputsValues)\n    })\n  }\n\n  setInputAvailability(optionInputs, availableOptionInputValues, existingOptionInputsValues) {\n    optionInputs.forEach((input) => {\n      if (availableOptionInputValues.includes(input.getAttribute('value'))) {\n        if (this.pickerType == 'select') {\n          input.innerText = input.getAttribute('value')\n          return\n        }\n        input.classList.remove('disabled')\n      } else {\n        if (existingOptionInputsValues.includes(input.getAttribute('value'))) {\n          if (this.pickerType == 'select') {\n            input.innerText = this.textStrings.soldOutVariantValueLabel.replace(\n              '[value]',\n              input.getAttribute('value')\n            )\n            return\n          }\n          input.classList.add('disabled')\n        } else {\n          if (this.pickerType == 'select') {\n            input.innerText = this.textStrings.unavailableVariantValueLabel.replace(\n              '[value]',\n              input.getAttribute('value')\n            )\n            return\n          }\n          input.classList.add('disabled')\n        }\n      }\n    })\n  }\n\n  swapProductInfo = () => {\n    window[window.slayedNamespace].helpers\n      .fetchHTML(\n        `${this.el.dataset.url}?variant=${this.currentVariant.id}&section_id=${this.el.dataset.section}`\n      )\n      .then((responseHTML) => {\n        const priceSource = responseHTML.querySelector(this.selectors.priceContainer)\n        const priceTarget = this.el.querySelector(this.selectors.priceContainer)\n        const mediaSource = responseHTML.querySelector(this.selectors.mediaContainer)\n        const mediaTarget = this.el.querySelector(this.selectors.mediaContainer)\n        const addButtonSource = responseHTML.querySelector(\n          `${this.selectors.productForm} [name=\"add\"]`\n        )\n        const addButtonTarget = this.el.querySelector(`${this.selectors.productForm} [name=\"add\"]`)\n\n        if (priceSource && priceTarget) {\n          priceTarget.replaceWith(priceSource)\n        }\n\n        if (mediaSource && mediaTarget) {\n          mediaTarget.replaceWith(mediaSource)\n        }\n\n        if (addButtonSource && addButtonTarget) {\n          addButtonTarget.replaceWith(addButtonSource)\n        }\n\n      })\n  }\n\n  getVariantData = () => {\n    this.variantData =\n      this.variantData || JSON.parse(this.el.querySelector(this.selectors.variantsJson).textContent)\n    return this.variantData\n  }\n}\n\nwindow.prodify = new Prodify()\n"],"names":["Prodify","settings","__publicField","matchingVariant","variant","option","index","stepDirection","previousQuantity","select","optionContainer","radio","event","responseHTML","priceSource","priceTarget","mediaSource","mediaTarget","addButtonSource","addButtonTarget","productForm","input","disable","text","modifyClass","addButton","addButtonText","options","currentValue","variantsMatchingOptionOneSelected","inputWrappers","optionInputs","previousOptionSelected","availableOptionInputsValues","variantOption","existingOptionInputsValues","availableOptionInputValues"],"mappings":"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"}